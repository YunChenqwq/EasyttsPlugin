# ========================================
# EasyttsPugin 配置文件（示例）
# - 仅保留 easytts（ModelScope Studio / Gradio）后端
# - 支持“云端仓库池”自动切换：优先选 queue_size 更小的仓库
# - 支持“按情绪回复”：emotion 直接当作 preset 使用（无需任何映射）
# 教程视频：https://www.bilibili.com/video/BV1tqFPzCEfm/
# ========================================

[plugin]
enabled = true # 是否启用插件
config_version = "0.1.0" # 配置版本（请勿修改）

[general]
# 语音文本翻译策略：
# - auto/off：不翻译（推荐中文模型，否则把中文翻成日语可能导致云端返回空音频/音频过小）
# - ja：翻译成日语（适合日语模型/日语角色）
voice_translate_to = "auto"
tts_mode_group = "free" # 群聊模式：free=自然一点；fixed=逐句语音
tts_mode_private = "free" # 私聊模式：free=自然一点；fixed=逐句语音
default_backend = "easytts" # 默认后端（本插件仅支持 easytts）
timeout = 60 # Action/Command 总体超时（秒）
max_text_length = 200 # 最大文本长度（超过会降级为文字回复）
use_replyer_rewrite = true # Action 是否调用 LLM 生成/润色最终语音回复文本
audio_output_dir = "" # 音频输出目录（留空使用项目根目录；use_base64_audio=true 时一般不落盘）
use_base64_audio = true # 是否用 base64 方式发送语音（推荐 true：无需保存文件）
split_sentences = true # Action 是否按标点分句逐句发送语音
split_delay = 0.3 # 分句发送间隔（秒）
send_error_messages = false # 失败时是否给用户发送错误提示（默认仅写入日志）
fixed_mode_infer_emotion = true # 固定模式：是否逐句选择语气（preset）
free_mode_infer_emotion = true # 自由模式：是否自动选择语气（preset）

[components]
action_enabled = true # 是否启用 Action（action 会进入 Planner 的可选列表，由 LLM 决定是否用语音回复）
command_enabled = true # 是否启用 Command（手动命令：/eztts）

[easytts]
default_character = "" # 默认角色（character），留空则启动后会自动抓取并填写
default_preset = "" # 默认预设（preset），留空则启动后会自动抓取并填写

# 启动时自动抓取云端 WebUI 的角色/预设下拉，并回写到本地 config.toml（给小白更直观）
auto_fetch_gradio_schema = true
schema_cache_ttl = 0
schema_cache_file = "_gradio_schema_cache.json"

# ========== 角色/预设（可视化编辑：固定 5 个槽位）==========
# MaiBot WebUI 对 list[object] 的渲染会显示为 [object Object]，不便于编辑；
# 因此用固定槽位字段来保证可视化表单可编辑。
character_1_name = "" # 角色槽位 1：启动后会自动填写（留空即可）
character_1_presets = "" # 角色槽位 1：启动后会自动填写（留空即可）

character_2_name = ""
character_2_presets = ""

character_3_name = ""
character_3_presets = ""

character_4_name = ""
character_4_presets = ""

character_5_name = ""
character_5_presets = ""

# ========== 云端仓库池调度 ==========
remote_split_sentence = true # 是否让远端也进行“分句合成”（Gradio 入参 split_sentence）
prefer_idle_endpoint = true # 是否优先选择更空闲的仓库（依据 queue/status 的 queue_size）
busy_queue_threshold = 0 # 繁忙阈值：queue_size > 该值视为忙（0=只有 queue_size==0 才算空闲）

# ========== 超时设置（秒）==========
status_timeout = 3 # /gradio_api/queue/status 超时
join_timeout = 30 # /gradio_api/queue/join 超时
sse_timeout = 120 # /gradio_api/queue/data（SSE）超时
download_timeout = 120 # 音频下载超时

trust_env = false # aiohttp 是否继承系统代理（Windows 环境常见代理导致连接问题，建议 false）

# 按情绪回复说明：
# - 本插件不做任何“情绪 -> 预设”映射；emotion 会被当作 preset 名使用
# - 因此 emotion 必须是该角色实际存在的 preset（见 character_X_presets）
# - 如果不传 emotion / 或传入的 preset 不存在：会回退到 default_preset（通常是“普通”）

# ========== 云端仓库池（可视化编辑：固定 5 个槽位）==========
endpoint_1_name = "pool-1" # 仓库池 1：名称（用于日志）
endpoint_1_base_url = "https://your-app.ms.show" # 仓库池 1：Gradio 基地址
endpoint_1_studio_token = "填你的 studio_token" # 仓库池 1：studio_token
endpoint_1_fn_index = 4
endpoint_1_trigger_id = 25

endpoint_2_name = "pool-2"
endpoint_2_base_url = "https://your-app-2.ms.show"
endpoint_2_studio_token = "填你的 studio_token"
endpoint_2_fn_index = 3
endpoint_2_trigger_id = 19

endpoint_3_name = "pool-3"
endpoint_3_base_url = ""
endpoint_3_studio_token = ""
endpoint_3_fn_index = 3
endpoint_3_trigger_id = 19

endpoint_4_name = "pool-4"
endpoint_4_base_url = ""
endpoint_4_studio_token = ""
endpoint_4_fn_index = 3
endpoint_4_trigger_id = 19

endpoint_5_name = "pool-5"
endpoint_5_base_url = ""
endpoint_5_studio_token = ""
endpoint_5_fn_index = 3
endpoint_5_trigger_id = 19
