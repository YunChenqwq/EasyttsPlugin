# ========================================
# EasyttsPugin 配置文件（示例）
# - 仅保留 easytts（ModelScope Studio / Gradio）后端
# - 支持“云端仓库池”自动切换：优先选 queue_size 更小的仓库
# - 支持“按情绪回复”：emotion 直接当作 preset 使用（无需任何映射）
# ========================================

[plugin]
enabled = true # 是否启用插件
config_version = "0.1.0" # 配置版本（请勿修改）
tips = "请不要在bot自己的webui中编辑配置文件，请打开文件编辑。" # 重要提示（WebUI 会显示这个字段）

[general]
default_backend = "easytts" # 默认后端（本插件仅支持 easytts）
timeout = 60 # Action/Command 总体超时（秒）
max_text_length = 200 # 最大文本长度（超过会降级为文字回复）
use_replyer_rewrite = true # Action 是否调用 LLM 生成/润色最终语音回复文本
audio_output_dir = "" # 音频输出目录（留空使用项目根目录；use_base64_audio=true 时一般不落盘）
use_base64_audio = true # 是否用 base64 方式发送语音（推荐 true：无需保存文件）
split_sentences = true # Action 是否按标点分句逐句发送语音
split_delay = 0.3 # 分句发送间隔（秒）
send_error_messages = true # 失败时是否给用户发送错误提示

[components]
action_enabled = true # 是否启用 Action（LLM_JUDGE：由计划器让 LLM 自由决定是否用语音回复）
command_enabled = true # 是否启用 Command（手动命令：/eztts）

[easytts]
default_character = "mika" # 默认角色（character）
default_preset = "普通" # 默认预设（preset）

# ========== 云端仓库池调度 ==========
remote_split_sentence = true # 是否让远端也进行“分句合成”（Gradio 入参 split_sentence）
prefer_idle_endpoint = true # 是否优先选择更空闲的仓库（依据 queue/status 的 queue_size）
busy_queue_threshold = 0 # 繁忙阈值：queue_size > 该值视为忙（0=只有 queue_size==0 才算空闲）

# ========== 超时设置（秒）==========
status_timeout = 3 # /gradio_api/queue/status 超时
join_timeout = 30 # /gradio_api/queue/join 超时
sse_timeout = 120 # /gradio_api/queue/data（SSE）超时
download_timeout = 120 # 音频下载超时

trust_env = false # aiohttp 是否继承系统代理（Windows 环境常见代理导致连接问题，建议 false）

# ========== 模型/角色列表 & 情绪预设 ==========
[[easytts.characters]]
name = "mika" # 角色名（对应 WebUI 的 character 下拉值）
presets = ["普通", "开心", "伤心", "生气", "害怕", "害羞", "惊讶", "认真", "疑问", "痛苦", "百感交集释然"] # 该角色可用的预设列表（对应 WebUI 的 preset 下拉值）

[[easytts.characters]]
name = "sagiri" # 新角色示例：和泉纱雾（预设与 mika 一致，可按需修改为你的模型实际预设）
presets = ["普通", "开心", "伤心", "生气", "害怕", "害羞", "惊讶", "认真", "疑问", "痛苦", "百感交集释然"]

# 按情绪回复说明：
# - 本插件不做任何“情绪 -> 预设”映射；emotion 会被当作 preset 名使用
# - 因此 emotion 必须是该角色实际存在的 preset（见 easytts.characters[*].presets）
# - 如果不传 emotion / 或传入的 preset 不存在：会回退到 default_preset（通常是“普通”）

# ========== 云端仓库池（按需填多个）==========
[[easytts.endpoints]]
name = "pool-1" # 仓库名（自定义，用于日志）
base_url = "https://your-app.ms.show" # Gradio 基地址（例如 https://xxx.ms.show）
studio_token = "填你的 studio_token" # 从浏览器抓包/控制台得到的 studio_token
fn_index = 3 # 触发合成的 fn_index（不同部署可能不同）
trigger_id = 19 # 触发合成的 trigger_id（不同部署可能不同）

[[easytts.endpoints]]
name = "pool-2"
base_url = "https://your-app-2.ms.show"
studio_token = "填你的 studio_token"
fn_index = 3
trigger_id = 19
